<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>fit - Ruby/GSL (v1.16.0.4)</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "../";
</script>

<script src="../js/jquery.js"></script>
<script src="../js/darkfish.js"></script>

<link href="../css/fonts.css" rel="stylesheet">
<link href="../css/rdoc.css" rel="stylesheet">



<body id="top" role="document" class="file">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../table_of_contents.html#pages">Pages</a>
    <a href="../table_of_contents.html#classes">Classes</a>
    <a href="../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  
<div class="nav-section">
  <h3>Table of Contents</h3>

  <ul class="link-list" role="directory">
    <li><a href="#label-Least-Squares+Fitting">Least-Squares Fitting</a>
    <li><a href="#label-Overview">Overview</a>
    <li><a href="#label-Linear+regression">Linear regression</a>
    <li><a href="#label-Module+functions+for+linear+regression">Module functions for linear regression</a>
    <li><a href="#label-Linear+fitting+without+a+constant+term">Linear fitting without a constant term</a>
    <li><a href="#label-Multi-parameter+fitting">Multi-parameter fitting</a>
    <li><a href="#label-Workspace+class">Workspace class</a>
    <li><a href="#label-Module+functions">Module functions</a>
    <li><a href="#label-Higer+level+interface">Higer level interface</a>
    <li><a href="#label-Examples">Examples</a>
    <li><a href="#label-Linear+regression">Linear regression</a>
    <li><a href="#label-Exponential+fitting">Exponential fitting</a>
    <li><a href="#label-Multi-parameter+fitting">Multi-parameter fitting</a>
  </ul>
</div>


  <div id="project-metadata">
    <div id="fileindex-section" class="nav-section">
  <h3>Pages</h3>

  <ul class="link-list">
  
    <li><a href="../COPYING.html">COPYING</a>
  
    <li><a href="../ChangeLog.html">ChangeLog</a>
  
    <li><a href="../README.html">README</a>
  
    <li><a href="../rdoc/alf_rdoc.html">alf</a>
  
    <li><a href="../rdoc/blas_rdoc.html">blas</a>
  
    <li><a href="../rdoc/bspline_rdoc.html">bspline</a>
  
    <li><a href="../rdoc/changes_rdoc.html">changes</a>
  
    <li><a href="../rdoc/cheb_rdoc.html">cheb</a>
  
    <li><a href="../rdoc/cholesky_complex_rdoc.html">cholesky_complex</a>
  
    <li><a href="../rdoc/combi_rdoc.html">combi</a>
  
    <li><a href="../rdoc/complex_rdoc.html">complex</a>
  
    <li><a href="../rdoc/const_rdoc.html">const</a>
  
    <li><a href="../rdoc/dht_rdoc.html">dht</a>
  
    <li><a href="../rdoc/diff_rdoc.html">diff</a>
  
    <li><a href="../rdoc/ehandling_rdoc.html">ehandling</a>
  
    <li><a href="../rdoc/eigen_rdoc.html">eigen</a>
  
    <li><a href="../rdoc/fft_rdoc.html">fft</a>
  
    <li><a href="../rdoc/fit_rdoc.html">fit</a>
  
    <li><a href="../rdoc/function_rdoc.html">function</a>
  
    <li><a href="../rdoc/graph_rdoc.html">graph</a>
  
    <li><a href="../rdoc/hist_rdoc.html">hist</a>
  
    <li><a href="../rdoc/hist2d_rdoc.html">hist2d</a>
  
    <li><a href="../rdoc/hist3d_rdoc.html">hist3d</a>
  
    <li><a href="../rdoc/integration_rdoc.html">integration</a>
  
    <li><a href="../rdoc/interp_rdoc.html">interp</a>
  
    <li><a href="../rdoc/intro_rdoc.html">intro</a>
  
    <li><a href="../rdoc/linalg_rdoc.html">linalg</a>
  
    <li><a href="../rdoc/linalg_complex_rdoc.html">linalg_complex</a>
  
    <li><a href="../rdoc/math_rdoc.html">math</a>
  
    <li><a href="../rdoc/matrix_rdoc.html">matrix</a>
  
    <li><a href="../rdoc/min_rdoc.html">min</a>
  
    <li><a href="../rdoc/monte_rdoc.html">monte</a>
  
    <li><a href="../rdoc/multimin_rdoc.html">multimin</a>
  
    <li><a href="../rdoc/multiroot_rdoc.html">multiroot</a>
  
    <li><a href="../rdoc/narray_rdoc.html">narray</a>
  
    <li><a href="../rdoc/ndlinear_rdoc.html">ndlinear</a>
  
    <li><a href="../rdoc/nonlinearfit_rdoc.html">nonlinearfit</a>
  
    <li><a href="../rdoc/ntuple_rdoc.html">ntuple</a>
  
    <li><a href="../rdoc/odeiv_rdoc.html">odeiv</a>
  
    <li><a href="../rdoc/perm_rdoc.html">perm</a>
  
    <li><a href="../rdoc/poly_rdoc.html">poly</a>
  
    <li><a href="../rdoc/qrng_rdoc.html">qrng</a>
  
    <li><a href="../rdoc/randist_rdoc.html">randist</a>
  
    <li><a href="../rdoc/ref_rdoc.html">ref</a>
  
    <li><a href="../rdoc/rng_rdoc.html">rng</a>
  
    <li><a href="../rdoc/roots_rdoc.html">roots</a>
  
    <li><a href="../rdoc/sf_rdoc.html">sf</a>
  
    <li><a href="../rdoc/siman_rdoc.html">siman</a>
  
    <li><a href="../rdoc/sort_rdoc.html">sort</a>
  
    <li><a href="../rdoc/start_rdoc.html">start</a>
  
    <li><a href="../rdoc/stats_rdoc.html">stats</a>
  
    <li><a href="../rdoc/sum_rdoc.html">sum</a>
  
    <li><a href="../rdoc/tensor_rdoc.html">tensor</a>
  
    <li><a href="../rdoc/tut_rdoc.html">tut</a>
  
    <li><a href="../rdoc/use_rdoc.html">use</a>
  
    <li><a href="../rdoc/vector_rdoc.html">vector</a>
  
    <li><a href="../rdoc/vector_complex_rdoc.html">vector_complex</a>
  
    <li><a href="../rdoc/wavelet_rdoc.html">wavelet</a>
  
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-label="Page rdoc/fit.rdoc">

<h1 id="label-Least-Squares+Fitting">Least-Squares Fitting<span><a href="#label-Least-Squares+Fitting">&para;</a> <a href="#top">&uarr;</a></span></h1>

<p>This chapter describes routines for performing least squares fits to
experimental data using linear combinations of functions. The data may be
weighted or unweighted, i.e. with known or unknown errors. For weighted
data the functions compute the best fit parameters and their associated
covariance matrix. For unweighted data the covariance matrix is estimated
from the scatter of the points, giving a variance-covariance matrix.</p>

<p>The functions are divided into separate versions for simple one- or
two-parameter regression and multiple-parameter fits.</p>

<p>Contents:</p>
<ol><li>
<p><a href="fit_rdoc.html#label-Overview">Overview</a></p>
</li><li>
<p><a href="fit_rdoc.html#label-Linear+regression">Linear regression</a></p>
<ol><li>
<p><a href="fit_rdoc.html#label-Module+functions+for+linear+regression">Module
functions for linear regression</a></p>
</li></ol>
</li><li>
<p><a href="fit_rdoc.html#label-Linear+fitting+without+a+constant+term">Linear
fitting without a constant term</a></p>
</li><li>
<p><a href="fit_rdoc.html#label-Multi-parameter+fitting">Multi-parameter
fitting</a></p>
<ol><li>
<p><a href="fit_rdoc.html#label-Workspace+class">GSL::MultiFit::Workspace
class</a></p>
</li><li>
<p><a href="fit_rdoc.html#label-Module+functions">Module functions</a></p>
</li><li>
<p><a href="fit_rdoc.html#label-Higer+level+interface">Higer level
interface</a></p>
</li><li>
<p><a href="ndlinear_rdoc.html">NDLINEAR: multi-linear, multi-parameter least
squares fitting</a> (GSL extension)</p>
</li></ol>
</li><li>
<p><a href="fit_rdoc.html#label-Examples">Examples</a></p>
<ol><li>
<p><a href="fit_rdoc.html#label-Linear+regression">Linear regression</a></p>
</li><li>
<p><a href="fit_rdoc.html#label-Exponential+fitting">Exponential fitting</a></p>
</li><li>
<p><a href="fit_rdoc.html#label-Multi-parameter+fitting">Multi-parameter
fitting</a></p>
</li></ol>
</li></ol>

<h2 id="label-Overview">Overview<span><a href="#label-Overview">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>Least-squares fits are found by minimizing chi^2 (chi-squared), the
weighted sum of squared residuals over n experimental datapoints (x_i, y_i)
for the model Y(c,x), The p parameters of the model are c = {c_0, c_1, â€¦}.
The weight factors w_i are given by w_i = 1/sigma_i^2, where sigma_i is the
experimental error on the data-point y_i. The errors are assumed to be
gaussian and uncorrelated. For unweighted data the chi-squared sum is
computed without any weight factors.</p>

<p>The fitting routines return the best-fit parameters c and their p times p
covariance matrix. The covariance matrix measures the statistical errors on
the best-fit parameters resulting from the errors on the data, sigma_i, and
is defined as C_{ab} = &lt;delta c_a delta c_b&gt; where &lt; &gt; denotes
an average over the gaussian error distributions of the underlying
datapoints.</p>

<p>The covariance matrix is calculated by error propagation from the data
errors sigma_i. The change in a fitted parameter delta c_a caused by a
small change in the data delta y_i is given by allowing the covariance
matrix to be written in terms of the errors on the data, For uncorrelated
data the fluctuations of the underlying datapoints satisfy &lt;delta y_i
delta y_j&gt; = sigma_i^2 delta_{ij}, giving a corresponding parameter
covariance matrix of When computing the covariance matrix for unweighted
data, i.e. data with unknown errors, the weight factors w_i in this sum are
replaced by the single estimate w = 1/sigma^2, where sigma^2 is the
computed variance of the residuals about the best-fit model, sigma^2 = sum
(y_i - Y(c,x_i))^2 / (n-p). This is referred to as the variance-covariance
matrix.</p>

<p>The standard deviations of the best-fit parameters are given by the square
root of the corresponding diagonal elements of the covariance matrix,
sigma_{c_a} = sqrt{C_{aa}}. The correlation coefficient of the fit
parameters c_a and c_b is given by rho_{ab} = C_{ab} / sqrt{C_{aa} C_{bb}}.</p>

<h2 id="label-Linear+regression">Linear regression<span><a href="#label-Linear+regression">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>The functions described in this section can be used to perform
least-squares fits to a straight line model, Y = c_0 + c_1 X. For weighted
data the best-fit is found by minimizing the weighted sum of squared
residuals, chi^2,</p>

<p>chi^2 = sum_i w_i (y_i - (c0 + c1 x_i))^2</p>

<p>for the parameters <code>c0, c1</code>. For unweighted data the sum is
computed with <code>w_i = 1</code>.</p>

<h3 id="label-Module+functions+for+linear+regression">Module functions for linear regression<span><a href="#label-Module+functions+for+linear+regression">&para;</a> <a href="#top">&uarr;</a></span></h3>
<hr>
<ul><li>
<p>GSL::Fit::linear(x, y)</p>

<p>This function computes the best-fit linear regression coefficients (c0,c1)
of the model Y = c0 + c1 X for the datasets <code>(x, y)</code>, two
vectors of equal length with stride 1. This returns an array of 7 elements,
<code>[c0, c1, cov00, cov01, cov11, chisq, status]</code>, where <code>c0,
c1</code> are the estimated parameters, <code>cov00, cov01, cov11</code>
are the variance-covariance matrix elements, <code>chisq</code> is the sum
of squares of the residuals, and <code>status</code> is the return code
from the GSL function <code>gsl_fit_linear()</code>.</p>
</li></ul>
<hr>
<ul><li>
<p>GSL::Fit::wlinear(x, w, y)</p>

<p>This function computes the best-fit linear regression coefficients (c0,c1)
of the model Y = c_0 + c_1 X for the weighted datasets <code>(x, y)</code>.
The vector <code>w</code>, specifies the weight of each datapoint, which is
the reciprocal of the variance for each datapoint in <code>y</code>. This
returns an array of 7 elements, same as the method <code>linear</code>.</p>
</li></ul>
<hr>
<ul><li>
<p>GSL::Fit::linear_est(x, c0, c1, c00, c01, c11)</p>
</li><li>
<p>GSL::Fit::linear_est(x, [c0, c1, c00, c01, c11])</p>

<p>This function uses the best-fit linear regression coefficients
<code>c0,c1</code> and their estimated covariance
<code>cov00,cov01,cov11</code> to compute the fitted function and its
standard deviation for the model Y = c_0 + c_1 X at the point
<code>x</code>. The returned value is an array of <code>[y, yerr]</code>.</p>
</li></ul>

<h2 id="label-Linear+fitting+without+a+constant+term">Linear fitting without a constant term<span><a href="#label-Linear+fitting+without+a+constant+term">&para;</a> <a href="#top">&uarr;</a></span></h2>
<hr>
<ul><li>
<p>GSL::Fit::mul(x, y)</p>

<p>This function computes the best-fit linear regression coefficient
<code>c1</code> of the model Y = c1 X for the datasets <code>(x, y)</code>,
two vectors of equal length with stride 1. This returns an array of 4
elements, <code>[c1, cov11, chisq, status]</code>.</p>
</li></ul>
<hr>
<ul><li>
<p>GSL::Fit::wmul(x, w, y)</p>

<p>This function computes the best-fit linear regression coefficient
<code>c1</code> of the model Y = c_1 X for the weighted datasets <code>(x,
y)</code>. The vector <code>w</code> specifies the weight of each
datapoint. The weight is the reciprocal of the variance for each datapoint
in <code>y</code>.</p>
</li></ul>
<hr>
<ul><li>
<p>GSL::Fit::mul_est(x, c1, c11)</p>
</li><li>
<p>GSL::Fit::mul_est(x, [c1, c11])</p>

<p>This function uses the best-fit linear regression coefficient
<code>c1</code> and its estimated covariance <code>cov11</code> to compute
the fitted function <code>y</code> and its standard deviation
<code>y_err</code> for the model Y = c_1 X at the point <code>x</code>. The
returned value is an array of <code>[y, yerr]</code>.</p>
</li></ul>

<h2 id="label-Multi-parameter+fitting">Multi-parameter fitting<span><a href="#label-Multi-parameter+fitting">&para;</a> <a href="#top">&uarr;</a></span></h2>

<h3 id="label-Workspace+class">Workspace class<span><a href="#label-Workspace+class">&para;</a> <a href="#top">&uarr;</a></span></h3>
<hr>
<ul><li>
<p>GSL::MultiFit::Workspace.alloc(n, p)</p>

<p>This creates a workspace for fitting a model to <code>n</code> observations
using <code>p</code> parameters.</p>
</li></ul>

<h3 id="label-Module+functions">Module functions<span><a href="#label-Module+functions">&para;</a> <a href="#top">&uarr;</a></span></h3>
<hr>
<ul><li>
<p>GSL::MultiFit::linear(X, y, work)</p>
</li><li>
<p>GSL::MultiFit::linear(X, y)</p>

<p>This function computes the best-fit parameters <code>c</code> of the model
<code>y = X c</code> for the observations <code>y</code> and the matrix of
predictor variables <code>X</code>. The variance-covariance matrix of the
model parameters <code>cov</code> is estimated from the scatter of the
observations about the best-fit. The sum of squares of the residuals from
the best-fit is also calculated. The returned value is an array of 4
elements, <code>[c, cov, chisq, status]</code>, where <code>c</code> is a
<a href="vector_rdoc.html">GSL::Vector</a> object which contains the
best-fit parameters, and <code>cov</code> is the variance-covariance matrix
as a <a href="matrix_rdoc.html">GSL::Matrix</a> object.</p>

<p>The best-fit is found by singular value decomposition of the matrix
<code>X</code> using the workspace provided in <code>work</code> (optional,
if not given, it is allocated internally). The modified Golub-Reinsch SVD
algorithm is used, with column scaling to improve the accuracy of the
singular values. Any components which have zero singular value (to machine
precision) are discarded from the fit.</p>
</li></ul>
<hr>
<ul><li>
<p>GSL::MultiFit::wlinear(X, w, y, work)</p>
</li><li>
<p>GSL::MultiFit::wlinear(X, w, y)</p>

<p>This function computes the best-fit parameters <code>c</code> of the model
<code>y = X c</code>  for the observations <code>y</code> and the matrix of
predictor variables <code>X</code>.  The covariance matrix of the model
parameters <code>cov</code> is estimated from the  weighted data. The
weighted sum of squares of the residuals from the best-fit is also
calculated. The returned value is an array of 4 elements, <code>[c: Vector,
cov: Matrix, chisq: Float, status: Fixnum]</code>. The best-fit is found by
singular value decomposition of the matrix <code>X</code> using the
workspace provided in <code>work</code> (optional). Any components which
have zero singular value (to machine precision) are discarded from the fit.</p>
</li></ul>
<hr>
<ul><li>
<p>GSL::MultiFit::linear_est(x, c, cov)</p>

<p>(GSL-1.8 or later) This method uses the best-fit multilinear regression
coefficients <code>c</code> and their covariance matrix <code>cov</code> to
compute the fitted function value <code>y</code> and its standard deviation
<code>y_err</code> for the model <code>y = x.c</code> at the point
<code>x</code>. This returns an array [<code>y, y_err</code>].</p>
</li></ul>
<hr>
<ul><li>
<p>GSL::MultiFit::linear_residuals(X, y, c[, r])</p>

<p>(GSL-1.11 or later) This method computes the vector of residuals <code>r =
y - X c</code> for the observations <code>y</code>, coefficients
<code>c</code> and matrix of predictor variables <code>X</code>, and
returns <code>r</code>.</p>
</li></ul>

<h3 id="label-Higer+level+interface">Higer level interface<span><a href="#label-Higer+level+interface">&para;</a> <a href="#top">&uarr;</a></span></h3>
<hr>
<ul><li>
<p>GSL::MultiFit::polyfit(x, y, order)</p>

<p>Finds the coefficient of a polynomial of order <code>order</code> that fits
the vector data (<code>x, y</code>) in a least-square sense.</p>

<p>Example:</p>

<pre class="ruby"><span class="ruby-comment">#!/usr/bin/env ruby</span>
<span class="ruby-identifier">require</span>(<span class="ruby-string">&quot;gsl&quot;</span>)

<span class="ruby-identifier">x</span> = <span class="ruby-constant">Vector</span>[<span class="ruby-value">1</span>, <span class="ruby-value">2</span>, <span class="ruby-value">3</span>, <span class="ruby-value">4</span>, <span class="ruby-value">5</span>]
<span class="ruby-identifier">y</span> = <span class="ruby-constant">Vector</span>[<span class="ruby-value">5.5</span>, <span class="ruby-value">43.1</span>, <span class="ruby-value">128</span>, <span class="ruby-value">290.7</span>, <span class="ruby-value">498.4</span>]
<span class="ruby-comment"># The results are stored in a polynomial &quot;coef&quot;</span>
<span class="ruby-identifier">coef</span>, <span class="ruby-identifier">err</span>, <span class="ruby-identifier">chisq</span>, <span class="ruby-identifier">status</span> = <span class="ruby-constant">MultiFit</span>.<span class="ruby-identifier">polyfit</span>(<span class="ruby-identifier">x</span>, <span class="ruby-identifier">y</span>, <span class="ruby-value">3</span>)

<span class="ruby-identifier">x2</span> = <span class="ruby-constant">Vector</span>.<span class="ruby-identifier">linspace</span>(<span class="ruby-value">1</span>, <span class="ruby-value">5</span>, <span class="ruby-value">20</span>)
<span class="ruby-identifier">graph</span>([<span class="ruby-identifier">x</span>, <span class="ruby-identifier">y</span>], [<span class="ruby-identifier">x2</span>, <span class="ruby-identifier">coef</span>.<span class="ruby-identifier">eval</span>(<span class="ruby-identifier">x2</span>)], <span class="ruby-string">&quot;-C -g 3 -S 4&quot;</span>)
</pre>
</li></ul>

<h2 id="label-Examples">Examples<span><a href="#label-Examples">&para;</a> <a href="#top">&uarr;</a></span></h2>

<h3 id="label-Linear+regression">Linear regression<span><a href="#label-Linear+regression">&para;</a> <a href="#top">&uarr;</a></span></h3>

<pre class="ruby"><span class="ruby-comment">#!/usr/bin/env ruby</span>
<span class="ruby-identifier">require</span>(<span class="ruby-string">&quot;gsl&quot;</span>)
<span class="ruby-identifier">include</span> <span class="ruby-constant">GSL</span><span class="ruby-operator">::</span><span class="ruby-constant">Fit</span>

<span class="ruby-identifier">n</span> = <span class="ruby-value">4</span>
<span class="ruby-identifier">x</span> = <span class="ruby-constant">Vector</span>.<span class="ruby-identifier">alloc</span>(<span class="ruby-value">1970</span>, <span class="ruby-value">1980</span>, <span class="ruby-value">1990</span>, <span class="ruby-value">2000</span>)
<span class="ruby-identifier">y</span> = <span class="ruby-constant">Vector</span>.<span class="ruby-identifier">alloc</span>(<span class="ruby-value">12</span>, <span class="ruby-value">11</span>, <span class="ruby-value">14</span>, <span class="ruby-value">13</span>)
<span class="ruby-identifier">w</span> = <span class="ruby-constant">Vector</span>.<span class="ruby-identifier">alloc</span>(<span class="ruby-value">0.1</span>, <span class="ruby-value">0.2</span>, <span class="ruby-value">0.3</span>, <span class="ruby-value">0.4</span>)

<span class="ruby-comment">#for i in 0...n do</span>
<span class="ruby-comment">#   printf(&quot;%e %e %e\n&quot;, x[i], y[i], 1.0/Math::sqrt(w[i]))</span>
<span class="ruby-comment">#end</span>

<span class="ruby-identifier">c0</span>, <span class="ruby-identifier">c1</span>, <span class="ruby-identifier">cov00</span>, <span class="ruby-identifier">cov01</span>, <span class="ruby-identifier">cov11</span>, <span class="ruby-identifier">chisq</span> = <span class="ruby-identifier">wlinear</span>(<span class="ruby-identifier">x</span>, <span class="ruby-identifier">w</span>, <span class="ruby-identifier">y</span>)

<span class="ruby-identifier">printf</span>(<span class="ruby-node">&quot;# best fit: Y = %g + %g X\n&quot;</span>, <span class="ruby-identifier">c0</span>, <span class="ruby-identifier">c1</span>);
<span class="ruby-identifier">printf</span>(<span class="ruby-node">&quot;# covariance matrix:\n&quot;</span>);
<span class="ruby-identifier">printf</span>(<span class="ruby-node">&quot;# [ %g, %g\n#   %g, %g]\n&quot;</span>,
        <span class="ruby-identifier">cov00</span>, <span class="ruby-identifier">cov01</span>, <span class="ruby-identifier">cov01</span>, <span class="ruby-identifier">cov11</span>);
<span class="ruby-identifier">printf</span>(<span class="ruby-node">&quot;# chisq = %g\n&quot;</span>, <span class="ruby-identifier">chisq</span>);
</pre>

<h3 id="label-Exponential+fitting">Exponential fitting<span><a href="#label-Exponential+fitting">&para;</a> <a href="#top">&uarr;</a></span></h3>

<pre class="ruby"><span class="ruby-comment">#!/usr/bin/env ruby</span>
<span class="ruby-identifier">require</span>(<span class="ruby-string">&quot;gsl&quot;</span>)

<span class="ruby-comment"># Create data</span>
<span class="ruby-identifier">r</span> = <span class="ruby-constant">Rng</span>.<span class="ruby-identifier">alloc</span>(<span class="ruby-string">&quot;knuthran&quot;</span>)
<span class="ruby-identifier">a</span> = <span class="ruby-value">2.0</span>
<span class="ruby-identifier">b</span> = <span class="ruby-value">-1.0</span>
<span class="ruby-identifier">sigma</span> = <span class="ruby-value">0.01</span>
<span class="ruby-constant">N</span> = <span class="ruby-value">10</span>
<span class="ruby-identifier">x</span> = <span class="ruby-constant">Vector</span>.<span class="ruby-identifier">linspace</span>(<span class="ruby-value">0</span>, <span class="ruby-value">5</span>, <span class="ruby-constant">N</span>)
<span class="ruby-identifier">y</span> = <span class="ruby-identifier">a</span><span class="ruby-operator">*</span><span class="ruby-constant">Sf</span><span class="ruby-operator">::</span><span class="ruby-identifier">exp</span>(<span class="ruby-identifier">b</span><span class="ruby-operator">*</span><span class="ruby-identifier">x</span>) <span class="ruby-operator">+</span> <span class="ruby-identifier">sigma</span><span class="ruby-operator">*</span><span class="ruby-identifier">r</span>.<span class="ruby-identifier">gaussian</span>

<span class="ruby-comment"># Fitting</span>
<span class="ruby-identifier">a2</span>, <span class="ruby-identifier">b2</span>, = <span class="ruby-constant">Fit</span>.<span class="ruby-identifier">linear</span>(<span class="ruby-identifier">x</span>, <span class="ruby-constant">Sf</span><span class="ruby-operator">::</span><span class="ruby-identifier">log</span>(<span class="ruby-identifier">y</span>))
<span class="ruby-identifier">x2</span> = <span class="ruby-constant">Vector</span>.<span class="ruby-identifier">linspace</span>(<span class="ruby-value">0</span>, <span class="ruby-value">5</span>, <span class="ruby-value">20</span>)
<span class="ruby-constant">A</span> = <span class="ruby-constant">Sf</span><span class="ruby-operator">::</span><span class="ruby-identifier">exp</span>(<span class="ruby-identifier">a2</span>)
<span class="ruby-identifier">printf</span>(<span class="ruby-string">&quot;Expect: a = %f, b = %f\n&quot;</span>, <span class="ruby-identifier">a</span>, <span class="ruby-identifier">b</span>)
<span class="ruby-identifier">printf</span>(<span class="ruby-string">&quot;Result: a = %f, b = %f\n&quot;</span>, <span class="ruby-constant">A</span>, <span class="ruby-identifier">b2</span>)
<span class="ruby-identifier">graph</span>([<span class="ruby-identifier">x</span>, <span class="ruby-identifier">y</span>], [<span class="ruby-identifier">x2</span>, <span class="ruby-constant">A</span><span class="ruby-operator">*</span><span class="ruby-constant">Sf</span><span class="ruby-operator">::</span><span class="ruby-identifier">exp</span>(<span class="ruby-identifier">b2</span><span class="ruby-operator">*</span><span class="ruby-identifier">x2</span>)], <span class="ruby-string">&quot;-C -g 3 -S 4&quot;</span>)
</pre>

<h3 id="label-Multi-parameter+fitting">Multi-parameter fitting<span><a href="#label-Multi-parameter+fitting">&para;</a> <a href="#top">&uarr;</a></span></h3>

<pre class="ruby"><span class="ruby-comment">#!/usr/bin/env ruby</span>
<span class="ruby-identifier">require</span>(<span class="ruby-string">&quot;gsl&quot;</span>)
<span class="ruby-identifier">include</span> <span class="ruby-constant">GSL</span><span class="ruby-operator">::</span><span class="ruby-constant">MultiFit</span>

<span class="ruby-constant">Rng</span>.<span class="ruby-identifier">env_setup</span>()

<span class="ruby-identifier">r</span> = <span class="ruby-constant">GSL</span><span class="ruby-operator">::</span><span class="ruby-constant">Rng</span>.<span class="ruby-identifier">alloc</span>(<span class="ruby-constant">Rng</span><span class="ruby-operator">::</span><span class="ruby-constant">DEFAULT</span>)
<span class="ruby-identifier">n</span> = <span class="ruby-value">19</span>
<span class="ruby-identifier">dim</span> = <span class="ruby-value">3</span>
<span class="ruby-constant">X</span> = <span class="ruby-constant">Matrix</span>.<span class="ruby-identifier">alloc</span>(<span class="ruby-identifier">n</span>, <span class="ruby-identifier">dim</span>)
<span class="ruby-identifier">y</span> = <span class="ruby-constant">Vector</span>.<span class="ruby-identifier">alloc</span>(<span class="ruby-identifier">n</span>)
<span class="ruby-identifier">w</span> = <span class="ruby-constant">Vector</span>.<span class="ruby-identifier">alloc</span>(<span class="ruby-identifier">n</span>)

<span class="ruby-identifier">a</span> = <span class="ruby-value">0.1</span>
<span class="ruby-keyword">for</span> <span class="ruby-identifier">i</span> <span class="ruby-keyword">in</span> <span class="ruby-value">0</span><span class="ruby-operator">...</span><span class="ruby-identifier">n</span>
  <span class="ruby-identifier">y0</span> = <span class="ruby-constant">Math</span><span class="ruby-operator">::</span><span class="ruby-identifier">exp</span>(<span class="ruby-identifier">a</span>)
  <span class="ruby-identifier">sigma</span> = <span class="ruby-value">0.1</span><span class="ruby-operator">*</span><span class="ruby-identifier">y0</span>
  <span class="ruby-identifier">val</span> = <span class="ruby-identifier">r</span>.<span class="ruby-identifier">gaussian</span>(<span class="ruby-identifier">sigma</span>)
  <span class="ruby-constant">X</span>.<span class="ruby-identifier">set</span>(<span class="ruby-identifier">i</span>, <span class="ruby-value">0</span>, <span class="ruby-value">1.0</span>)
  <span class="ruby-constant">X</span>.<span class="ruby-identifier">set</span>(<span class="ruby-identifier">i</span>, <span class="ruby-value">1</span>, <span class="ruby-identifier">a</span>)
  <span class="ruby-constant">X</span>.<span class="ruby-identifier">set</span>(<span class="ruby-identifier">i</span>, <span class="ruby-value">2</span>, <span class="ruby-identifier">a</span><span class="ruby-operator">*</span><span class="ruby-identifier">a</span>)
  <span class="ruby-identifier">y</span>[<span class="ruby-identifier">i</span>] = <span class="ruby-identifier">y0</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">val</span>
  <span class="ruby-identifier">w</span>[<span class="ruby-identifier">i</span>] = <span class="ruby-value">1.0</span><span class="ruby-operator">/</span>(<span class="ruby-identifier">sigma</span><span class="ruby-operator">*</span><span class="ruby-identifier">sigma</span>)
  <span class="ruby-comment">#printf(&quot;%g %g %g\n&quot;, a, y[i], sigma)</span>
  <span class="ruby-identifier">a</span> <span class="ruby-operator">+=</span> <span class="ruby-value">0.1</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">c</span>, <span class="ruby-identifier">cov</span>, <span class="ruby-identifier">chisq</span>, <span class="ruby-identifier">status</span> = <span class="ruby-constant">MultiFit</span>.<span class="ruby-identifier">wlinear</span>(<span class="ruby-constant">X</span>, <span class="ruby-identifier">w</span>, <span class="ruby-identifier">y</span>)
</pre>

<p><a href="multimin_rdoc.html">prev</a> <a
href="nonlinearfit_rdoc.html">next</a></p>

<p><a href="ref_rdoc.html">Reference index</a> <a href="../index.html">top</a></p>
</main>



<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="http://docs.seattlerb.org/rdoc/">RDoc</a> 4.2.0.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

